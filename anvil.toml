# Anvil - Configuração do Projeto

[project]
name = "RedstoneOS"
root = ".."

# ============================================================================
# Componentes
# ============================================================================

[components.kernel]
path = "forge"
target = "x86_64-redstone"
default_profile = "release"

[components.bootloader]
path = "ignite"
target = "x86_64-unknown-uefi"
default_profile = "release"

[[components.services]]
name = "supervisor"
path = "services/supervisor"
target = "x86_64-unknown-none"

[[components.services]]
name = "firefly"
path = "firefly/compositor"
target = "x86_64-unknown-none"

[[components.services]]
name = "shell"
path = "firefly/shell"
target = "x86_64-unknown-none"

[[components.services]]
name = "input"
path = "services/input"
target = "x86_64-unknown-none"

[[components.apps]]
name = "terminal"
path = "firefly/apps/terminal"
target = "x86_64-unknown-none"

[[components.apps]]
name = "index"
path = "firefly/apps/index"
target = "x86_64-unknown-none"

# ============================================================================
# QEMU
# ============================================================================

[qemu]
memory = "512M"
ovmf = "/usr/share/qemu/OVMF.fd"
serial = "stdio"
monitor = "none"
drive_interface = "virtio"
enable_gdb = false
gdb_port = 1234
extra_args = ["-no-reboot", "-no-shutdown", "-device", "virtio-gpu-pci"]
# Para video VGA
# extra_args = ["-no-reboot", "-no-shutdown", "-device", "VGA,vgamem_mb=16"]
# drive_interface: str = "virtio" nao funciona, tem que ser configurado manualmente

[qemu.logging]
flags = ["cpu_reset", "guest_errors", "unimp"]
serial_file = "../dist/qemu-serial.log"
internal_file = "../dist/qemu-internal.log"

# ============================================================================
# Análise
# ============================================================================

[analysis]
context_lines = 100
auto_inspect_binary = true
stop_on_exception = true

# Padrões de exceção conhecidos
[[analysis.patterns]]
name = "sse_in_kernel"
trigger = "v=06.*RIP=ffffffff"
diagnosis = "Instrução SSE/AVX gerada no kernel (proibido)"
solution = "Verificar flags -mno-sse no target.json"
severity = "critical"

[[analysis.patterns]]
name = "page_fault"
trigger = "v=0e"
diagnosis = "Page Fault (#PF)"
solution = "Verificar CR2 para endereço inválido"
severity = "critical"

[[analysis.patterns]]
name = "general_protection"
trigger = "v=0d"
diagnosis = "General Protection Fault (#GP)"
solution = "Verificar segmentos, permissões ou instrução inválida"
severity = "critical"

[[analysis.patterns]]
name = "double_fault"
trigger = "v=08"
diagnosis = "Double Fault (#DF)"
solution = "Stack overflow ou IDT corrompida"
severity = "critical"
